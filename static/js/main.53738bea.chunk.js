(this["webpackJsonpannorxiver-journal-recommender"]=this["webpackJsonpannorxiver-journal-recommender"]||[]).push([[0],{13:function(e,t,n){},16:function(e,t,n){e.exports=n(35)},21:function(e,t,n){},23:function(e,t,n){},24:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(9),l=n(1);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createElement("style",null,"\n    #logo:hover #star,\n    #logo[data-spin] #star {\n      animation: star_rotate 2s ease forwards infinite;\n    }\n    @keyframes star_rotate {\n      from {\n        transform: rotate(0);\n      }\n      to {\n        transform: rotate(360deg);\n      }\n    }\n  "),i=r.a.createElement("path",{id:"book_filling",fill:"#ffe0b2",d:"       M 10 50       L 50 70       L 90 50       L 90 35       L 50 55       L 10 35       A 10 10 0 0 0 10 50       M 10 65       L 50 85       L 90 65       L 90 50       L 50 70       L 10 50       A 10 10 0 0 0 10 65     "}),m=r.a.createElement("path",{id:"book_top_cover",fill:"#000000",stroke:"#000000",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",d:"       M 50 15       L 90 35       L 50 55       L 10 35       z     "}),d=r.a.createElement("path",{id:"book_outlines",fill:"none",stroke:"#000000",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",d:"       M 10 50       L 30 60       M 47.5 68.75       L 50 70       L 90 50       M 10 65       L 50 85       L 90 65       M 10 35       A 10 10 0 0 0 10 50       A 10 10 0 0 0 10 65     "}),p=r.a.createElement("path",{id:"bookmark",fill:"#000000",stroke:"#000000",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",d:"       M 35 55       L 35 71.25       L 38.75 69.25       L 42.5 74.75       L 42.5 58.75       z     "}),f=r.a.createElement("g",{transform:"translate(50,34) rotate(26.565) skewX(-26.565) scale(0.10)"},r.a.createElement("path",{id:"star",fill:"#ffe0b2",stroke:"#ffe0b2",strokeWidth:20,strokeLinecap:"round",strokeLinejoin:"round",d:"         M 0.000 -100.000         L 29.389 -40.451         L 95.106 -30.902         L 47.553 15.451         L 58.779 80.902         L 0.000 50.000         L -58.779 80.902         L -47.553 15.451         L -95.106 -30.902         L -29.389 -40.451         z       "})),b=function(e){var t=e.svgRef,n=e.title,a=s(e,["svgRef","title"]);return r.a.createElement("svg",o({viewBox:"0 0 100 100",id:"logo",ref:t},a),n?r.a.createElement("title",null,n):null,u,i,m,d,p,f)},E=r.a.forwardRef((function(e,t){return r.a.createElement(b,o({svgRef:t},e))})),h=(n.p,n(21),function(){return r.a.createElement("header",null,r.a.createElement("section",null,r.a.createElement("h1",null,"AnnoRxver"),r.a.createElement("h2",null,"Journal Recommender"),r.a.createElement(E,{className:"logo"})))}),v=n(2),j=n.n(v),g=n(4),O=n(8),w=n(3),y=n(11),k=function(){var e=Object(g.a)(j.a.mark((function e(t){var n,a,r,c,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api-journal-rec.greenelab.com/doi/"+t);case 2:return e.next=4,e.sent.json();case 4:return n=e.sent,a=n.journal_neighbors||[],r=n.paper_neighbors||[],c={x:n["2d_coord"].dim1,y:n["2d_coord"].dim2},l=function(e){return e.pmcid=(e.pmcid||e.document||"").replace("PMC","")},a.forEach(l),r.forEach(l),e.abrupt("return",{recommendedJournals:a,relatedPapers:r,coordinates:c});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(g.a)(j.a.mark((function e(t){var n,a,r,c,l,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.recommendedJournals,a=t.relatedPapers,r=Object(y.a)(t,["recommendedJournals","relatedPapers"]),c=[].concat(Object(w.a)(n),Object(w.a)(a)).map((function(e){return e.pmcid})).filter((function(e){return e})),e.next=4,fetch("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pmc&tool=AnnoRxivir&email=greenescientist@gmail.com&retmode=json&id="+c.join(","));case 4:return e.next=6,e.sent.json();case 6:return l=e.sent.result,o=function(e){return Object(O.a)(Object(O.a)({},e),l[e.pmcid]||{})},n=n.map(o),a=a.map(o),e.abrupt("return",Object(O.a)({recommendedJournals:n,relatedPapers:a},r));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(e){var t=e.recommendedJournals,n=e.relatedPapers,a=Object(y.a)(e,["recommendedJournals","relatedPapers"]);return t=x(t),n=x(n),Object(O.a)({recommendedJournals:t,relatedPapers:n},a)},x=function(e){var t=e.map((function(e){return e.distance})),n=Math.max.apply(Math,Object(w.a)(t)),a=Math.min.apply(Math,Object(w.a)(t)),r=n-a;return e.sort((function(e,t){return e.distance-t.distance})),e=e.map((function(e,t){return{id:e.pmcid||null,title:e.title||"",authors:(e.authors||[]).map((function(e){return e.name||""})).filter((function(e){return e})).join(", "),journal:(e.fulljournalname||e.journal||"").split("_").join(" "),year:(e.pubdate||"").split(" ")[0]||"",distance:e.distance,strength:(e.distance-a)/r,rank:t+1}}))},N=(n(23),function(e){var t=e.status;return"LOADING"===t?r.a.createElement("section",{className:"center"},r.a.createElement("div",{className:"message loading"},r.a.createElement("i",{className:"fas fa-spinner fa-spin"}),r.a.createElement("span",null,"Loading..."))):"ERROR"===t?r.a.createElement("section",{className:"center"},r.a.createElement("div",{className:"error"},r.a.createElement("i",{className:"far fa-times-circle"}),r.a.createElement("span",null,"Couldn't get results"))):null}),P=(n(24),function(e){var t=e.status,n=e.setStatus,c=e.setRecommendedJournals,o=e.setRelatedPapers,s=e.setCoordinates,u=Object(a.useState)(C()||"10.1101/833400"),i=Object(l.a)(u,2),m=i[0],d=i[1],p=Object(a.useCallback)((function(e){var t=e.target.value.trim(),n=t.search(/\d/);d(-1!==n?t.substr(n):"")}),[]),f=Object(a.useCallback)(function(){var e=Object(g.a)(j.a.mark((function e(t){var a,r,l,u,i,m=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(m.length>1&&void 0!==m[1])||m[1],n("LOADING"),a&&_(t),e.prev=3,e.t0=L,e.t1=S,e.next=8,k(t);case 8:return e.t2=e.sent,e.next=11,(0,e.t1)(e.t2);case 11:return e.t3=e.sent,e.next=14,(0,e.t0)(e.t3);case 14:r=e.sent,l=r.recommendedJournals,u=r.relatedPapers,i=r.coordinates,c(l),o(u),s(i),n("SUCCESS"),e.next=28;break;case 24:e.prev=24,e.t4=e.catch(3),console.log(e.t4),n("ERROR");case 28:case"end":return e.stop()}}),e,null,[[3,24]])})));return function(t){return e.apply(this,arguments)}}(),[s,c,o,n]),b=Object(a.useCallback)((function(){var e=C();e&&(d(e),f(e,!1))}),[f]);return Object(a.useEffect)((function(){C()&&f(C())}),[f]),Object(a.useEffect)((function(){return window.addEventListener("popstate",b),function(){return window.removeEventListener("popstate",b)}}),[b,f]),r.a.createElement("section",null,r.a.createElement("p",{className:"center"},r.a.createElement("i",null,"Enter the ",r.a.createElement("a",{href:"https://www.biorxiv.org/"},"bioRxiv")," DOI of your preprint")),r.a.createElement("form",{className:"search",onSubmit:function(e){e.preventDefault(),m.trim()&&f(m)}},r.a.createElement("input",{className:"search_input",value:m,onChange:p,type:"text",placeholder:"e.g. 10.1101/833400",disabled:"LOADING"===t}),r.a.createElement("button",{className:"search_button",type:"submit",title:"Search for related papers and journals",disabled:"LOADING"===t},r.a.createElement("i",{className:"fas fa-search"}))))}),C=function(){return new URLSearchParams(window.location.search.substring(1)).get("doi")},_=function(e){var t=window.location.href,n=window.location.href.split(/[?#]/)[0]+"?doi="+e;t!==n&&window.history.pushState(null,null,n)},M=(n(13),function(e){var t=e.recommendedJournals;return r.a.createElement("section",null,r.a.createElement("h3",null,r.a.createElement("i",{className:"fas fa-bookmark"}),"Recommended Journals"),t.map((function(e,t){var n=e.journal,a=e.rank,c=e.distance,l=e.strength;return r.a.createElement("div",{key:t,className:"card"},r.a.createElement("div",{className:"card_score",title:"Distance score: "+c,style:{backgroundColor:"#ff9800"+Math.floor(255*(1-l)).toString(16).padStart(2,"0"),borderColor:"#ff9800"}},a),r.a.createElement("div",{className:"card_details"},r.a.createElement("a",{href:"https://www.google.com/search?q="+n},n)))})))}),R=function(e){var t=e.relatedPapers;return r.a.createElement("section",null,r.a.createElement("h3",null,r.a.createElement("i",{className:"fas fa-scroll"}),"Related Papers"),t.map((function(e,t){var n=e.id,a=e.title,c=e.authors,l=e.year,o=e.journal,s=e.rank,u=e.distance,i=e.strength;return r.a.createElement("div",{key:t,className:"card"},r.a.createElement("div",{className:"card_score",title:"Distance score: "+u,style:{backgroundColor:"#ff9800"+Math.floor(255*(1-i)).toString(16).padStart(2,"0"),borderColor:"#ff9800"}},s),r.a.createElement("div",{className:"card_details"},r.a.createElement("a",{href:"https://www.ncbi.nlm.nih.gov/pmc/articles/"+n,title:a},a),r.a.createElement("div",{title:c},c),r.a.createElement("div",{title:o+" \xb7 "+l},o," \xb7 ",l)))})))},J=n(10),A=n(39),I=n(6),D=n.n(I),T=(n(32),D()("#606060")),B=D()("#e0e0e0"),F=D()("#ff9800"),G=D()("#e0e0e0"),W=D()("#2196f3"),X=function(e){var t=e.coordinates,n=Object(a.useState)([]),c=Object(l.a)(n,2),o=c[0],s=c[1],u=Object(a.useState)(null),i=Object(l.a)(u,2),m=i[0],d=i[1],p=Object(a.useState)(null),f=Object(l.a)(p,2),b=f[0],E=f[1];return Object(a.useEffect)((function(){(function(){var e=Object(g.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s,e.next=3,fetch("./data/plot.json");case 3:return e.next=5,e.sent.json();case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),r.a.createElement("section",null,r.a.createElement("h3",{id:"map"},r.a.createElement("i",{className:"fas fa-map"}),"Map of PubMed Central"),r.a.createElement(q,{selectedPc:m,setSelectedPc:d}),r.a.createElement(V,{cells:o,selectedPc:m,selectedCell:b,setSelectedCell:E,coordinates:t}),r.a.createElement(K,{selectedPc:m,coordinates:t}),b&&r.a.createElement(Q,{selectedCell:b,selectedPc:m,setSelectedPc:d}))},q=function(e){var t,n,a=e.selectedPc,c=e.setSelectedPc;return r.a.createElement("p",{className:"center"},(t=1,n=50,Array.from({length:n-t+1},(function(e,n){return t+n}))).map((function(e){return r.a.createElement(H,Object.assign({key:e},{number:e,selectedPc:a,setSelectedPc:c}))})))},z=function(e){return String(e).padStart(2,"0")},U=function(e){return"https://raw.githubusercontent.com/greenelab/annorxiver/master/biorxiv/pca_association_experiment/output/word_pca_similarity/figures/pca_XX_cossim_word_cloud.png".replace("XX",z(e))},H=function(e){var t=e.number,n=e.selectedPc,o=e.setSelectedPc,s=Object(a.useState)(!1),u=Object(l.a)(s,2),i=u[0],m=u[1],d=Object(a.useState)(null),p=Object(l.a)(d,2),f=p[0],b=p[1],E=Object(a.useState)(null),h=Object(l.a)(E,2),v=h[0],j=h[1],g=Object(a.useRef)(),O=Object(A.a)(f,v,{placement:"top",modifiers:[{name:"computeStyles",options:{adaptive:!1}},{name:"offset",options:{offset:[0,10]}},{name:"flip",options:{rootBoundary:"document"}}]}),w=O.styles,y=O.attributes,k=O.update;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{ref:b,className:"cloud_button","data-number":z(t),"data-selected":n===t,onClick:function(){return o(n===t?null:t)},onMouseEnter:function(){window.clearTimeout(g.current),g.current=window.setTimeout((function(){return m(!0)}),100)},onMouseLeave:function(){window.clearTimeout(g.current),m(!1)}},r.a.createElement("img",{src:U(t),title:"Select principal component "+z(t),alt:"Select principal component "+z(t),onLoad:k})),i&&Object(c.createPortal)(r.a.createElement("img",Object.assign({ref:j,src:U(t),className:"cloud_enlarged",title:"Select principal component "+z(t),alt:"Select principal component "+z(t),onLoad:k,style:w.popper},y.popper)),document.body))},V=function(e){var t,n=e.cells,c=e.selectedPc,o=e.selectedCell,s=e.setSelectedCell,u=e.coordinates,i=Object(a.useRef)(),m=Object(a.useState)(""),d=Object(l.a)(m,2),p=d[0],f=d[1],b=n.map((function(e){return e.count})),E=Math.min.apply(Math,Object(w.a)(b)),h=Math.max.apply(Math,Object(w.a)(b)),v=Object(J.a)(n);try{for(v.s();!(t=v.n()).done;){var j=t.value;j.countStrength=(j.count-E)/(h-E)}}catch(P){v.e(P)}finally{v.f()}var g,O=Object(J.a)(n);try{for(O.s();!(g=O.n()).done;){var y=g.value,k=y.pcs.find((function(e){return e.name===z(c)}));y.score=(null===k||void 0===k?void 0:k.score)||0}}catch(P){O.e(P)}finally{O.f()}var S,L=Math.max.apply(Math,Object(w.a)(n.map((function(e){return Math.abs(e.score)}))))||1,x=Object(J.a)(n);try{for(x.s();!(S=x.n()).done;){var N=S.value;N.scoreStrength=N.score/L}}catch(P){x.e(P)}finally{x.f()}return Object(a.useEffect)((function(){if(i.current){var e=i.current.getBBox(),t=e.x,n=e.y,a=e.width,r=e.height;f([t,n,a,r].join(" "))}}),[n]),r.a.createElement("p",null,r.a.createElement("svg",{ref:i,viewBox:p||void 0,className:"map"},n.sort((function(e,t){return e===o?1:t===o?-1:0})).map((function(e,t){return r.a.createElement("rect",{key:t,className:"cell",x:10*e.x-5,y:10*e.y-5,width:10,height:10,"data-selected":e===o,fill:c?G.mix(e.scoreStrength>0?F:W,Math.abs(e.scoreStrength)).hex():B.mix(T,e.countStrength),onClick:function(){return s(e===o?null:e)}})})),u.x&&u.y&&r.a.createElement("circle",{className:"marker",cx:10*u.x,cy:10*u.y,r:10/3})))},K=function(e){var t=e.selectedPc,n=e.coordinates;return r.a.createElement("p",{className:"legend"},t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,r.a.createElement("span",{style:{backgroundColor:F}}),"pos pc",z(t)),r.a.createElement("span",null,r.a.createElement("span",{style:{backgroundColor:W}}),"neg pc",z(t))),!t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,r.a.createElement("span",{style:{backgroundColor:T}}),"many papers"),r.a.createElement("span",null,r.a.createElement("span",{style:{backgroundColor:B}}),"few papers")),n.x&&n.y&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,r.a.createElement("span",{style:{backgroundColor:"var(--red)"}}),"your preprint")))},Q=function(e){var t=e.selectedCell,n=e.selectedPc,a=e.setSelectedPc;return r.a.createElement("div",null,r.a.createElement("h4",null,"Papers"),r.a.createElement("p",null,t.count.toLocaleString()),r.a.createElement("h4",null,"Top Journals"),r.a.createElement("p",null,t.journals.map((function(e,t){var n=e.name,a=e.count;return r.a.createElement("span",{key:t,className:"cell_detail_row"},r.a.createElement("span",null,n),r.a.createElement("span",null,a.toLocaleString()," papers"),r.a.createElement("br",null))}))),r.a.createElement("h4",null,"Top Principal Components"),r.a.createElement("p",null,t.pcs.slice(0,5).map((function(e,t){var c=e.name,l=e.score;return r.a.createElement("span",{key:t,className:"cell_detail_row"},r.a.createElement("a",{role:"button",title:"Select principal component "+z(parseInt(c)),onClick:function(){return a(parseInt(c))}},c,parseInt(c)===n&&r.a.createElement("i",{className:"fas fa-check"})),r.a.createElement("span",null,l.toFixed(2)," score"),r.a.createElement("br",null))}))))},Y=function(){return r.a.createElement("section",null,r.a.createElement("h3",null,r.a.createElement("i",{className:"fas fa-question-circle"}),"What does this do?"),r.a.createElement("p",null,"This tool uses a machine learning model trained on 1.7 million"," ",r.a.createElement("a",{href:"https://www.ncbi.nlm.nih.gov/pmc/"},"PubMed Central")," documents to recommend suitable journals based on the textual content of your"," ",r.a.createElement("a",{href:"https://www.biorxiv.org/"},"bioRxiv")," preprint. For information on how this works, see the"," ",r.a.createElement("a",{href:"https://github.com/greenelab/annorxiver-journal-recommender#annorxiver-journal-recommender"},"readme on GitHub"),"."))},Z=(n(33),function(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),n=t[0],c=t[1],o=Object(a.useRef)(),s=Object(a.useCallback)((function(){window.clearTimeout(o.current),$("#map")?c(!1):o.current=window.setTimeout((function(){return c(!0)}),3e3)}),[]);return Object(a.useEffect)((function(){return s(),window.addEventListener("scroll",s),function(){return window.removeEventListener("scroll",s)}}),[s]),Object(a.useLayoutEffect)((function(){s()})),r.a.createElement("button",{className:"continue_arrow","data-show":n,disabled:!n,onClick:function(){return document.querySelector("#map").scrollIntoView()}},r.a.createElement("i",{className:"fas fa-arrow-down fa-2x"}))}),$=function(e){return document.querySelector(e).getBoundingClientRect().bottom<window.innerHeight},ee=function(){return r.a.createElement("footer",null,r.a.createElement("section",null,r.a.createElement("p",null,"A project of the ",r.a.createElement("a",{href:"https://greenelab.com/"},"Greene Lab"),r.a.createElement("br",null),r.a.createElement("a",{href:"https://github.com/greenelab/annorxiver_journal_rec_app"},r.a.createElement("i",{className:"fab fa-github"}),r.a.createElement("span",null,"View on GitHub")))))},te=(n(34),function(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)([]),s=Object(l.a)(o,2),u=s[0],i=s[1],m=Object(a.useState)([]),d=Object(l.a)(m,2),p=d[0],f=d[1],b=Object(a.useState)({}),E=Object(l.a)(b,2),v=E[0],j=E[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(h,null),r.a.createElement("main",null,r.a.createElement(P,{status:n,setStatus:c,setRecommendedJournals:i,setRelatedPapers:f,setCoordinates:j}),r.a.createElement(N,{status:n}),"SUCCESS"===n&&r.a.createElement(M,{recommendedJournals:u}),"SUCCESS"===n&&r.a.createElement(R,{relatedPapers:p}),r.a.createElement(X,{coordinates:v}),r.a.createElement(Y,null),r.a.createElement(Z,null)),r.a.createElement(ee,null))});Object(c.render)(r.a.createElement(te,null),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.53738bea.chunk.js.map